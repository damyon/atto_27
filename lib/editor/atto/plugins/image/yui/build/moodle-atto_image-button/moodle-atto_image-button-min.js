YUI.add("moodle-atto_image-button",function(e,t){var n={BUTTON:".atto_image_button",TAGS:"img"};M.atto_image=M.atto_image||{dialogue:null,selection:null,init:function(t){var r=function(t,r){t.preventDefault(),M.editor_atto.is_active(r)||M.editor_atto.focus(r),M.atto_image.selection=M.editor_atto.get_selection();if(M.atto_image.selection!==!1){var i;M.atto_image.dialogue?i=M.atto_image.dialogue:i=new M.core.dialogue({visible:!1,modal:!0,close:!0,draggable:!0}),i.set("bodyContent",M.atto_image.get_form_content(r)),i.set("headerContent",M.util.get_string("createimage","atto_image")),i.render(),i.centerDialogue(),M.atto_image.dialogue=i;var s=M.editor_atto.get_selected_nodes(r);s=s.filter(n.TAGS);if(s.size()>0){var o=s.item(0),u=o.getAttribute("width"),a=o.getAttribute("height");u>0&&e.one("#atto_image_widthentry").set("value",u),a>0&&e.one("#atto_image_heightentry").set("value",a),e.one("#atto_image_preview").set("src",o.get("src")),e.one("#atto_image_preview").setStyle("display","inline"),e.one("#atto_image_altentry").set("value",o.get("alt")),e.one("#atto_image_urlentry").set("value",o.get("src"));var f=o.get("role");f==="presentation"&&e.one("#atto_image_presentation").set("checked","checked")}i.show()}},i=M.util.image_url("e/insert_edit_image","core");M.editor_atto.add_toolbar_button(t.elementid,"image",i,t.group,r,this);var s=M.editor_atto.get_editable_node(t.elementid);s.on("atto:selectionchanged",function(e){var t=M.editor_atto.get_toolbar_node(e.elementid),r=t.one(n.BUTTON);e.selectedNodes.filter(n.TAGS).size()>0?r.addClass("active"):r.removeClass("active")})},open_filepicker:function(e){var t=this.getAttribute("data-editor");e.preventDefault(),M.editor_atto.show_filepicker(t,"image",M.atto_image.filepicker_callback)},filepicker_callback:function(t){if(t.url!==""){var n=e.one("#atto_image_urlentry");n.set("value",t.url);var r=new Image;r.onload=function(){e.one("#atto_image_widthentry").set("value",this.width),e.one("#atto_image_heightentry").set("value",this.height),e.one("#atto_image_preview").set("src",this.src),e.one("#atto_image_preview").setStyle("display","inline")},r.src=t.url}},url_changed:function(){var t=e.one("#atto_image_urlentry");if(t.get("value")!==""){var n=new Image;n.onload=function(){var t;t=e.one("#atto_image_widthentry"),t.get("value")===""&&t.set("value",this.width),t=e.one("#atto_image_heightentry"),t.get("value")===""&&t.set("value",this.height),t=e.one("#atto_image_preview"),t.set("src",this.src),t.setStyle("display","inline")},n.src=t.get("value")}},set_image:function(t,n){var r=t.currentTarget.ancestor(".atto_form").one("#atto_image_urlentry"),i=r.get("value");r=t.currentTarget.ancestor(".atto_form").one("#atto_image_altentry");var s=r.get("value");r=t.currentTarget.ancestor(".atto_form").one("#atto_image_widthentry");var o=r.get("value");r=t.currentTarget.ancestor(".atto_form").one("#atto_image_heightentry");var u=r.get("value");r=t.currentTarget.ancestor(".atto_form").one("#atto_image_presentation");var a=r.get("checked"),f;t.preventDefault();if(s===""&&!a){f=t.currentTarget.ancestor(".atto_form").one("#atto_image_altwarning"),f.setStyle("display","block"),r=t.currentTarget.ancestor(".atto_form").one("#atto_image_altentry"),r.setAttribute("aria-invalid",!0),r=t.currentTarget.ancestor(".atto_form").one("#atto_image_presentation"),r.setAttribute("aria-invalid",!0);return}f=t.currentTarget.ancestor(".atto_form").one("#atto_image_altwarning"),f.setStyle("display","none"),r=t.currentTarget.ancestor(".atto_form").one("#atto_image_altentry"),r.setAttribute("aria-invalid",!1),r=t.currentTarget.ancestor(".atto_form").one("#atto_image_presentation"),r.setAttribute("aria-invalid",!1),M.atto_image.dialogue.hide();if(i!==""){M.editor_atto.set_selection(M.atto_image.selection);var l='<img src="'+e.Escape.html(i)+'" alt="'+e.Escape.html(s)+'"';o&&(l+=' width="'+e.Escape.html(o)+'"'),u&&(l+=' height="'+e.Escape.html(u)+'"'),a&&(l+=' role="presentation"'),l+="/>",document.selection&&document.selection.createRange().pasteHTML?document.selection.createRange().pasteHTML(l):document.execCommand("insertHTML",!1,l),M.editor_atto.text_updated(n)}},get_form_content:function(t){var n='<form class="atto_form"><label for="atto_image_urlentry">'+M.util.get_string("enterurl","atto_image")+"</label>"+'<input class="fullwidth" type="url" value="" id="atto_image_urlentry" size="32"/>'+"<br/>";M.editor_atto.can_show_filepicker(t,"image")&&(n+='<button id="openimagebrowser" data-editor="'+e.Escape.html(t)+'" type="button">'+M.util.get_string("browserepositories","atto_image")+"</button>"+"<br/>"),n+='<div style="display:none" role="alert" id="atto_image_altwarning" class="warning">'+M.util.get_string("presentationoraltrequired","atto_image")+"</div>"+'<label for="atto_image_altentry">'+M.util.get_string("enteralt","atto_image")+"</label>"+'<input class="fullwidth" type="text" value="" id="atto_image_altentry" size="32"/>'+"<br/>"+'<input type="checkbox" id="atto_image_presentation"/>'+'<label class="sameline" for="atto_image_presentation">'+M.util.get_string("presentation","atto_image")+"</label>"+"<br/>"+'<label class="sameline" for="atto_image_widthentry">'+M.util.get_string("width","atto_image")+"</label>"+'<input type="text" value="" id="atto_image_widthentry" size="10"/>'+"<br/>"+'<label class="sameline" for="atto_image_heightentry">'+M.util.get_string("height","atto_image")+"</label>"+'<input type="text" value="" id="atto_image_heightentry" size="10"/>'+"<br/>"+'<label for="atto_image_preview">'+M.util.get_string("preview","atto_image")+"</label>"+'<img src="#" width="200" id="atto_image_preview" alt="" style="display: none;"/>'+'<div class="mdl-align">'+"<br/>"+'<button id="atto_image_urlentrysubmit" type="submit">'+M.util.get_string("createimage","atto_image")+"</button>"+"</div>"+"</form>"+"<hr/>"+M.util.get_string("accessibilityhint","atto_image");var r=e.Node.create(n);return r.one("#atto_image_urlentry").on("blur",M.atto_image.url_changed,this),r.one("#atto_image_urlentrysubmit"
).on("click",M.atto_image.set_image,this,t),M.editor_atto.can_show_filepicker(t,"image")&&r.one("#openimagebrowser").on("click",M.atto_image.open_filepicker),r}}},"@VERSION@",{requires:["node","escape"]});
